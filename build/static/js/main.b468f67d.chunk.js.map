{"version":3,"sources":["focused-image.js","focus-picker.js","faceDetection.js","combined-focus-picker.js","Combined.js","index.js"],"names":["Image","styled","img","_templateObject","Object","taggedTemplateLiteral","FocusedImageComponent","_ref","imageSrc","x","y","imageRef","useRef","useEffect","current","FocusedImage","focus","react_default","a","createElement","alt","ref","src","defaultProps","startingFocus","FocusPickerComponent","_ref$debounceTime","debounceTime","onFocusChanged","_useState","useState","_useState2","slicedToArray","focusCoordinates","setFocusCoordinates","console","log","imageHTML","originalWidth","clientWidth","originalHeight","clientHeight","_ref2","asyncToGenerator","regenerator_default","mark","_callee","cropObj","_cropObj$topCrop","width","height","focusX","focusY","wrap","_context","prev","next","smartcrop","crop","ruleOfThirds","minScale","sent","topCrop","stop","apply","this","arguments","asyncFn","debouncedOnFocusChanged","debounce","FocusPicker","onChange","React","memo","drawDot","ctx","radius","fillStyle","beginPath","arc","Math","PI","fill","drawRect","top","bottom","left","right","size","color","lineWidth","strokeStyle","rect","stroke","drawText","text","font","concat","fillText","drawBackground","image","drawImage","calculateWeightedCentroid","detections","_detections$","_detections$$detectio","_detections$2","_detections$2$detecti","faceInfo","centerX","detection","imageWidth","centerY","imageHeight","map","ele","_ele$detection","_ele$detection$box","_ele$detection2","_ele$detection2$box","_ele$detection3","_ele$detection3$box","_ele$detection4","_ele$detection4$box","faceCenterX","box","faceCenterY","distanceWeight","abs","area","scoreWeight","classScore","maxArea","max","toConsumableArray","fi","sums","objectSpread2","areaWeight","reduce","curr","weightAverage","weightSum","weightedXSum","weightedYSum","distances","sqrt","pow","_getMeanAndSd","array","n","length","mean","b","sd","getMeanAndSd","faceSelected","dis","val","border","currIdx","FaceDetection","setImage","canvasRef","Promise","all","faceapi","ssdMobilenetv1","loadFromUri","faceLandmark68Net","catch","e","handleImage","canvasSize","resized","results","offsetWidth","offsetHeight","withFaceLandmarks","innerHtml","getContext","forEach","round","Container","maxWidth","Box","sx","m","display","flexDirection","Typography","variant","component","type","files","reader","FileReader","onload","result","readAsDataURL","fileHandler","target","style","faceDetected","calcX","calcY","Combined","_React$useState","_React$useState2","setFocus","_useState3","_useState4","setFaceDetected","className","combined_focus_picker","focused_image","App","algo","setAlgo","SelectAlgorithm","alignItems","justifyContent","Button","onClick","Fragment","faceDetection","src_Combined","focus_picker","rootElement","document","getElementById","ReactDOM","render","src_App"],"mappings":"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","file":"static/js/main.b468f67d.chunk.js","sourcesContent":["import React, { useEffect, useRef } from \"react\";\nimport styled from \"styled-components\";\nimport PropTypes from \"prop-types\";\nimport { FocusedImage } from \"image-focus\";\n\nconst Image = styled.img`\n  transition: top 0.25s ease-in-out, left 0.25s ease-in-out;\n`;\n\nconst FocusedImageComponent = ({ imageSrc, x, y }) => {\n  const imageRef = useRef(null);\n\n  useEffect(() => {\n    if (imageRef.current !== null) {\n      new FocusedImage(imageRef.current, {\n        focus: {\n          x,\n          y\n        }\n      });\n    }\n  }, [x, y]);\n\n  return <Image alt=\"Focused\" ref={imageRef} src={imageSrc} />;\n};\n\nFocusedImageComponent.defaultProps = {\n  x: 0,\n  y: 0\n};\n\nFocusedImageComponent.propTypes = {\n  imageSrc: PropTypes.string,\n  x: PropTypes.number,\n  y: PropTypes.number\n};\n\nexport default FocusedImageComponent;\n","import React, { useEffect, useRef, useState } from \"react\";\nimport debounce from \"lodash.debounce\";\nimport PropTypes from \"prop-types\";\nimport { FocusPicker } from \"image-focus\";\nimport smartcrop from \"smartcrop\";\n\nconst startingFocus = { x: -2, y: -2 };\n\nconst FocusPickerComponent = ({\n  debounceTime = 300,\n  imageSrc,\n  onFocusChanged\n}) => {\n  const imageRef = useRef(null);\n\n  const [focusCoordinates, setFocusCoordinates] = useState(startingFocus)\n\n\n  console.log(focusCoordinates);\n\n  useEffect(() => {\n    console.log(\"imgElRef.current\", imageRef.current);\n    let imageHTML = imageRef.current;\n\n    const originalWidth = imageHTML.clientWidth\n    const originalHeight = imageHTML.clientHeight\n\n    console.log(\"html image\", imageHTML);\n\n    const asyncFn = async () => {\n      const cropObj = await smartcrop.crop(imageHTML, {\n        width: originalHeight,\n        height: originalWidth,\n        ruleOfThirds: true,\n        minScale: 1.0\n      });\n      console.log(\"crop\", cropObj.topCrop);\n\n      const { x, y, width, height } = cropObj.topCrop;\n\n      console.log(x);\n      console.log(y);\n      console.log(width);\n      console.log(height);\n\n      const focusX = (x + width/2)/(originalWidth/2) - 1\n      const focusY = (y + height/2)/(originalHeight/2) - 1\n      console.log(focusX);\n      console.log(focusY);\n\n      setFocusCoordinates({ x: focusX, y: focusY })\n      \n    };\n    asyncFn();\n  }, [imageSrc]);\n\n  useEffect(() => {\n    if (imageRef.current !== null) {\n      const debouncedOnFocusChanged = debounce(onFocusChanged, debounceTime);\n      new FocusPicker(imageRef.current, {\n        onChange: debouncedOnFocusChanged,\n        focus: focusCoordinates\n      });\n    }\n  }, [debounceTime, onFocusChanged, focusCoordinates]);\n\n  return <img alt=\"Focus picker\" ref={imageRef} src={imageSrc}/>;\n};\n\nFocusPickerComponent.defaultProps = {\n  onFocusChanged: () => {}\n};\n\nFocusPickerComponent.propTypes = {\n  debounceTime: PropTypes.number,\n  imageSrc: PropTypes.string,\n  onFocusChanged: PropTypes.func\n};\n\nexport default React.memo(FocusPickerComponent);\n","import React, { useRef, useEffect, useState } from 'react'\nimport * as faceapi from 'face-api.js'\n\nimport Box from '@mui/material/Box';\nimport Container from '@mui/material/Container';\nimport Typography from '@mui/material/Typography';\n\nconst drawDot = (ctx, x, y, radius) => {\n  ctx.fillStyle = '#000000'\n  ctx.beginPath()\n  ctx.arc(x, y, radius, 0, 2*Math.PI)\n  ctx.fill()\n}\nconst drawRect = (ctx, top, bottom, left, right, size, color) => {\n  ctx.beginPath();\n  ctx.lineWidth = size;\n  ctx.strokeStyle = color;\n  ctx.rect(left, top, right - left, bottom - top);\n  ctx.stroke();\n}\nconst drawText = (ctx, text, x, y, size, color) => {\n  ctx.fillStyle = color;\n  ctx.font = `${size}px serif`;\n  ctx.fillText(text, x, y)\n}\nconst drawBackground = (ctx, image, width, height) => {\n  ctx.drawImage(image, 0, 0, width, height)\n}\n\nconst getMeanAndSd = (array) => {\n  const n = array.length\n  const mean = array.reduce((a, b) => a + b) / n\n  return {\n    mean,\n    sd: Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n),\n  }\n}\n\nconst calculateWeightedCentroid = (detections) => {\n  let faceInfo = [];\n\n  const centerX = detections?.[0]?.detection?.imageWidth / 2;\n  const centerY = detections?.[0]?.detection?.imageHeight / 2;\n\n  faceInfo = detections?.map(ele => {\n    \n    const faceCenterX = ( ele?.detection?.box?.left + ele?.detection?.box?.right ) / 2;\n    const faceCenterY = ( ele?.detection?.box?.top + ele?.detection?.box?.bottom ) / 2;\n    const distanceWeightX = 1 - Math.abs(faceCenterX - centerX) / centerX;\n    const distanceWeightY = 1 - Math.abs(faceCenterY - centerY) / centerY;\n    const distanceWeight = (distanceWeightX + distanceWeightY) / 2;\n\n    return {\n      top: ele.detection.box.top,\n      bottom: ele.detection.box.bottom,\n      left: ele.detection.box.left,\n      right: ele.detection.box.right,\n      faceCenterX,\n      faceCenterY,\n      area: ele.detection.box.area,\n      scoreWeight: ele.detection.classScore,\n      distanceWeight: distanceWeight,\n    }\n  })\n\n  const maxArea = Math.max(...faceInfo.map(fi => fi.area));\n  faceInfo = faceInfo.map(fi => {\n    return {\n      ...fi,\n      areaWeight: fi.area / maxArea,\n    }\n  })\n\n  const sums = faceInfo.reduce((prev, curr) => {\n    const weightAverage = (curr.scoreWeight + curr.distanceWeight + curr.areaWeight) / 3;\n    return {\n      ...prev,\n      weightSum: prev.weightSum + weightAverage,\n      weightedXSum: prev.weightedXSum + curr.faceCenterX * weightAverage,\n      weightedYSum: prev.weightedYSum + curr.faceCenterY * weightAverage,\n    }\n  }, {weightSum: 0, weightedXSum: 0, weightedYSum: 0});\n  const x = sums.weightedXSum / sums.weightSum;\n  const y = sums.weightedYSum / sums.weightSum;\n\n  const distances = faceInfo.map(fi => Math.sqrt(Math.pow((x - fi.faceCenterX), 2) + Math.pow((y - fi.faceCenterY), 2)));\n\n  const {mean, sd} = getMeanAndSd(distances);\n  const numOfSdArray = distances.map(dis => Math.abs((dis - mean) / sd));\n  const faceSelected = numOfSdArray.map(val => val > 2 ? 0 : 1);\n\n  const border = faceInfo.reduce((prev, curr, currIdx) => {\n    if (!faceSelected[currIdx]) return prev;\n    return {\n      ...prev,\n      top: prev.top < curr.top ? prev.top : curr.top,\n      bottom: prev.bottom > curr.bottom ? prev.bottom : curr.bottom,\n      left: prev.left < curr.left ? prev.left: curr.left,\n      right: prev.right > curr.right ? prev.right : prev.right,\n    }\n  })\n\n  return {\n    centerX: x,\n    centerY: y,\n    border,\n    faceInfo\n  }\n}\n\nfunction FaceDetection() {\n  const [image, setImage] = useState(null);\n  const imageRef = useRef(null);\n  const canvasRef = useRef(null);\n  \n  useEffect(() => {\n    console.log('Initialize')\n    const loadModels = () => {\n      Promise.all([\n        faceapi.nets.ssdMobilenetv1.loadFromUri('./models'),\n        faceapi.nets.faceLandmark68Net.loadFromUri('./models'),\n        \n      ]).catch(e => console.log(e))\n    }\n    imageRef.current && loadModels();\n  }, [])\n\n  useEffect(() => {\n    console.log(imageRef.current.src)\n    if(imageRef.current.src) {\n      handleImage();\n    }\n  }, [image])\n  \n\n  const handleImage = async () => {\n    const canvasSize = {\n      width: imageRef.current.offsetWidth,\n      height: imageRef.current.offsetHeight,\n    }\n    \n    const detections = await faceapi\n    .detectAllFaces(imageRef.current)\n    .withFaceLandmarks()\n    \n    console.log('Original:', detections)\n    canvasRef.current.innerHtml = faceapi.createCanvasFromMedia(imageRef.current);\n    \n    console.log(canvasRef.current.innerHtml)\n    faceapi.matchDimensions(canvasRef.current, canvasSize);\n    const resized = faceapi.resizeResults(detections, canvasSize)\n    console.log('RESIZED:', resized)\n    // faceapi.draw.drawDetections(canvasRef.current, resized);\n    // faceapi.draw.drawFaceLandmarks(canvasRef.current, resized);\n\n    const results = calculateWeightedCentroid(resized)\n    const ctx = canvasRef.current.getContext('2d');\n    drawBackground(ctx, imageRef.current, canvasSize.width, canvasSize.height);\n    \n    results.faceInfo.forEach(fi => {\n      drawRect(ctx, fi.top, fi.bottom, fi.left, fi.right, 2, 'red')\n      drawText(ctx, Math.round(fi.scoreWeight*100) / 100, fi.left, fi.top, 40, 'white')\n\n    })\n    drawDot(ctx, results.centerX, results.centerY, 20);\n    drawRect(ctx, results.border.top, results.border.bottom, results.border.left, results.border.right,8, 'green');\n    \n  }\n  const fileHandler = (files) => {\n    console.log(files[0])\n    let reader = new FileReader();\n    reader.onload = function() {\n      let image = reader.result;\n      setImage(image);\n    };\n    reader.readAsDataURL(files[0]);\n  };\n\n  return (\n    <Container maxWidth=\"lg\">\n      <Box \n        sx={{ \n          m: 4, \n          display: 'flex', \n          flexDirection: 'column'\n        }}\n      >\n        <Typography variant=\"h4\" component=\"h1\">\n          Facial Detection\n        </Typography>\n        <input\n          type=\"file\"\n          onChange={e => {\n            fileHandler(e.target.files);\n          }}\n        />\n        <img ref={imageRef} src={image} />\n        { imageRef.current && <canvas ref={canvasRef} style={{\n          border: '4px solid #000000', \n          // backgroundImage: `url(${uri})`, \n          // backgroundPosition: 'center',\n          // backgroundSize: 'cover',\n          // backgroundRepeat: 'no-repeat'\n        }} />}\n      \n      </Box>\n    </Container>\n    \n  )\n}\n\nexport default FaceDetection","import React, { useEffect, useRef, useState } from \"react\";\nimport debounce from \"lodash.debounce\";\nimport PropTypes from \"prop-types\";\nimport { FocusPicker } from \"image-focus\";\nimport smartcrop from \"smartcrop\";\n\nconst startingFocus = { x: -2, y: -2 };\n\nconst FocusPickerComponent = ({\n  debounceTime = 300,\n  imageSrc,\n  onFocusChanged,\n  focus,\n  faceDetected\n}) => {\n  const imageRef = useRef(null);\n\n  const [focusCoordinates, setFocusCoordinates] = useState(startingFocus)\n\n  useEffect(() => {\n    let imageHTML = imageRef.current;\n\n    const originalWidth = imageHTML.clientWidth\n    const originalHeight = imageHTML.clientHeight\n  \n\n    const asyncFn = async () => {\n      const cropObj = await smartcrop.crop(imageHTML, {\n        width: originalHeight,\n        height: originalWidth,\n        ruleOfThirds: true,\n        minScale: 1.0\n      });\n      const { x, y, width, height } = cropObj.topCrop;\n      const focusX = (x + width/2)/(originalWidth/2) - 1\n      const focusY = (y + height/2)/(originalHeight/2) - 1\n\nconsole.log(\"focus\");\nconsole.log(focus);\n\n  if (faceDetected) {\nconsole.log(originalHeight)\n    const calcX = 1- Math.abs(focus.x-originalWidth)/(originalWidth/2)\n    const calcY = Math.abs(focus.y-originalHeight)/(originalHeight/2) - 1\n    console.log(calcX);\n    console.log(calcY);\n    setFocusCoordinates({ x: calcX, y: calcY })\n    console.log(\"with Face detection\");\n  }else {\n    setFocusCoordinates({ x: focusX, y: focusY })\n    console.log(\"without face detection\");\n  }\n    };\n    asyncFn();\n  }, [imageSrc, faceDetected]);\n\n  useEffect(() => {\n    if (imageRef.current !== null) {\n       const debouncedOnFocusChanged = debounce(onFocusChanged, debounceTime);\n      new FocusPicker(imageRef.current, {\n        onChange: debouncedOnFocusChanged,\n        focus: focusCoordinates\n      });\n    }\n  }, [onFocusChanged, focusCoordinates, faceDetected, focus]);\n\n  return <img alt=\"Focus picker\" ref={imageRef} src={imageSrc}/>;\n};\n\nFocusPickerComponent.defaultProps = {\n  onFocusChanged: () => {}\n};\n\nFocusPickerComponent.propTypes = {\n  imageSrc: PropTypes.string,\n  onFocusChanged: PropTypes.func\n};\n\nexport default React.memo(FocusPickerComponent);\n","import React, { useState, useEffect, useRef } from \"react\";\nimport * as faceapi from 'face-api.js'\nimport \"./styles.css\";\nimport FocusedImage from \"./focused-image\";\nimport CombinedFocusPicker from \"./combined-focus-picker\";\n\n\nconst getMeanAndSd = (array) => {\n  const n = array.length\n  const mean = array.reduce((a, b) => a + b) / n\n  return {\n    mean,\n    sd: Math.sqrt(array.map(x => Math.pow(x - mean, 2)).reduce((a, b) => a + b) / n),\n  }\n}\n\nconst calculateWeightedCentroid = (detections) => {\n  let faceInfo = [];\n\n  const centerX = detections?.[0]?.detection?.imageWidth / 2;\n  const centerY = detections?.[0]?.detection?.imageHeight / 2;\n\n  faceInfo = detections?.map(ele => {\n    \n    const faceCenterX = ( ele?.detection?.box?.left + ele?.detection?.box?.right ) / 2;\n    const faceCenterY = ( ele?.detection?.box?.top + ele?.detection?.box?.bottom ) / 2;\n    const distanceWeightX = 1 - Math.abs(faceCenterX - centerX) / centerX;\n    const distanceWeightY = 1 - Math.abs(faceCenterY - centerY) / centerY;\n    const distanceWeight = (distanceWeightX + distanceWeightY) / 2;\n\n    return {\n      top: ele.detection.box.top,\n      bottom: ele.detection.box.bottom,\n      left: ele.detection.box.left,\n      right: ele.detection.box.right,\n      faceCenterX,\n      faceCenterY,\n      area: ele.detection.box.area,\n      scoreWeight: ele.detection.classScore,\n      distanceWeight: distanceWeight,\n    }\n  })\n\n  const maxArea = Math.max(...faceInfo.map(fi => fi.area));\n  faceInfo = faceInfo.map(fi => {\n    return {\n      ...fi,\n      areaWeight: fi.area / maxArea,\n    }\n  })\n\n  const sums = faceInfo.reduce((prev, curr) => {\n    const weightAverage = (curr.scoreWeight + curr.distanceWeight + curr.areaWeight) / 3;\n    return {\n      ...prev,\n      weightSum: prev.weightSum + weightAverage,\n      weightedXSum: prev.weightedXSum + curr.faceCenterX * weightAverage,\n      weightedYSum: prev.weightedYSum + curr.faceCenterY * weightAverage,\n    }\n  }, {weightSum: 0, weightedXSum: 0, weightedYSum: 0});\n  const x = sums.weightedXSum / sums.weightSum;\n  const y = sums.weightedYSum / sums.weightSum;\n\n  const distances = faceInfo.map(fi => Math.sqrt(Math.pow((x - fi.faceCenterX), 2) + Math.pow((y - fi.faceCenterY), 2)));\n\n  const {mean, sd} = getMeanAndSd(distances);\n  const numOfSdArray = distances.map(dis => Math.abs((dis - mean) / sd));\n  const faceSelected = numOfSdArray.map(val => val > 2 ? 0 : 1);\n\n  const border = faceInfo.reduce((prev, curr, currIdx) => {\n    if (!faceSelected[currIdx]) return prev;\n    return {\n      ...prev,\n      top: prev.top < curr.top ? prev.top : curr.top,\n      bottom: prev.bottom > curr.bottom ? prev.bottom : curr.bottom,\n      left: prev.left < curr.left ? prev.left: curr.left,\n      right: prev.right > curr.right ? prev.right : prev.right,\n    }\n  })\n\n  return {\n    centerX: x,\n    centerY: y,\n    border,\n    faceInfo\n  }\n}\n\n\nconst Combined = () => {\n  const startingFocus = {x:0, y:0};\n  const [image, setImage] = React.useState(null);\n  const [focus, setFocus] = useState(startingFocus);\n  const [faceDetected, setFaceDetected] =useState(null)\n  const imageRef = useRef(null);\n\n\n  const fileHandler = files => {\n    setFaceDetected(null)\n    let reader = new FileReader();\n    reader.onload = function() {\n      let image = reader.result;\n      setImage(null)\n      setImage(image);\n    };\n    reader.readAsDataURL(files[0]);\n    \n  };\n\nuseEffect(() => {\n  console.log('Initialize')\n  const loadModels = () => {\n    Promise.all([\n      faceapi.nets.ssdMobilenetv1.loadFromUri('./models'),\n      faceapi.nets.faceLandmark68Net.loadFromUri('./models'),\n      \n    ]).catch(e => console.log(e))\n  }\n  imageRef.current && loadModels();\n}, [])\n\nuseEffect(() => {\n  if(imageRef.current.src) {\n    handleImage();\n  }\n}, [image])\n\n\nconst handleImage = async () => {\n  const canvasSize = {\n    width: imageRef.current.offsetWidth,\n    height: imageRef.current.offsetHeight,\n  }\n  \n  const detections = await faceapi\n  .detectAllFaces(imageRef.current)\n  .withFaceLandmarks()\n\n  if (detections.length > 0) {\n    // const resized = faceapi.resizeResults(detections, canvasSize)\n    const results = calculateWeightedCentroid(detections)\n    setFocus({x:results.centerX, y:results.centerY})\n    setFaceDetected(true)\n  }else {\n    console.log(\"No face Detected\");\n    setFaceDetected(false)\n  }\n  \n}\n  return (\n   <div className=\"app\">\n      <h1>Combined Focal Point Detection Algorithm</h1>\n      <h2>{image ? faceDetected ? \"Face/s Detected\" : \"No Face/s Detected\": null}</h2>\n      <input\n        type=\"file\"\n        onChange={e => {\n          fileHandler(e.target.files);\n        }}\n      /> \n      <br/>\n      <br/>\n      {image && <div className=\"container\">\n        <div className=\"focus-picker-container\">\n          {faceDetected !== null && <CombinedFocusPicker\n            imageSrc={image}\n            onFocusChanged={setFocus}\n            focus = {focus}\n            faceDetected={faceDetected}\n          />}\n          \n        </div>\n        <hr className=\"spacer\" />\n        <div className=\"grid-container\">\n          <div className=\"grid\">\n            <div className=\"top-left\">\n              <FocusedImage\n                imageSrc={image}\n                x={ focus.x}\n                y={ focus.y}\n              />\n            </div>\n            <div className=\"top-center\">\n              <FocusedImage\n                imageSrc={image}\n                x={focus.x}\n                y={focus.y}\n              />\n            </div>\n            <div className=\"top-right\">\n              <FocusedImage\n                imageSrc={image}\n                x={focus.x}\n                y={focus.y}\n              />\n            </div>\n            <div className=\"center-left\">\n              <FocusedImage\n                imageSrc={image}\n                x={focus.x}\n                y={focus.y}\n              />\n            </div>\n            <div className=\"center-center\">\n              <FocusedImage\n                imageSrc={image}\n                x={focus.x}\n                y={focus.y}\n              />\n            </div>\n            <div className=\"center-right\">\n              <FocusedImage\n                imageSrc={image}\n                x={focus.x}\n                y={focus.y}\n              />\n            </div>\n          </div>\n        </div>\n      </div>}\n      <img ref={imageRef} src={image} />\n    </div>\n    \n  );\n};\n\nexport default Combined\n","import React, { useState } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"./styles.css\";\nimport FocusedImage from \"./focused-image\";\nimport FocusPicker from \"./focus-picker\";\nimport FaceDetection from \"./faceDetection\";\nimport Combined from \"./Combined\"\nimport Button from '@mui/material/Button';\nimport Container from '@mui/material/Container';\n\n\nconst App = () => {\n  const startingFocus = { x: 0, y: 0 };\n  const [image, setImage] = React.useState(null);\n  const [focus, setFocus] = useState(startingFocus);\n  const [algo, setAlgo] = useState(false)\n\nconst SelectAlgorithm = () => {\n      return (\n        <Container sx={{ height:\"100vh\", display:\"flex\", alignItems:\"center\", justifyContent:\"space-around\"}}>\n            <Button variant=\"contained\" size=\"large\" onClick={()=>setAlgo(\"standard\")}>\n              Standard Focus Detection Algorithm\n            </Button>\n            <Button variant=\"contained\" size=\"large\" onClick={()=>setAlgo(\"face\")}>\n              Facial Recognition Focus Detection\n            </Button>\n            <Button variant=\"contained\" size=\"large\" onClick={()=>setAlgo(\"combined\")}>\n              Combined Algorithm\n            </Button>\n        </Container>\n      )\n    }\n\n  const fileHandler = files => {\n    let reader = new FileReader();\n    reader.onload = function() {\n      let image = reader.result;\n      setImage(null)\n      setImage(image);\n    };\n    reader.readAsDataURL(files[0]);\n  };\n  return (\n<>\n\n{!algo && <SelectAlgorithm />}\n\n{algo == \"face\" && <FaceDetection />}\n\n{algo === \"combined\" && <Combined />}\n\n\n    {algo === \"standard\" && <div className=\"app\">\n      <h1>Focused Image Picker</h1>\n      <input\n        type=\"file\"\n        onChange={e => {\n          fileHandler(e.target.files);\n        }}\n      /> \n      <br/>\n      <br/>\n      {image && <div className=\"container\">\n        <div className=\"focus-picker-container\">\n          <FocusPicker\n            imageSrc={image}\n            onFocusChanged={setFocus}\n          />\n        </div>\n        <hr className=\"spacer\" />\n        <div className=\"grid-container\">\n          <div className=\"grid\">\n            <div className=\"top-left\">\n              <FocusedImage\n                imageSrc={image}\n                x={focus.x}\n                y={focus.y}\n              />\n            </div>\n            <div className=\"top-center\">\n              <FocusedImage\n                imageSrc={image}\n                x={focus.x}\n                y={focus.y}\n              />\n            </div>\n            <div className=\"top-right\">\n              <FocusedImage\n                imageSrc={image}\n                x={focus.x}\n                y={focus.y}\n              />\n            </div>\n            <div className=\"center-left\">\n              <FocusedImage\n                imageSrc={image}\n                x={focus.x}\n                y={focus.y}\n              />\n            </div>\n            <div className=\"center-center\">\n              <FocusedImage\n                imageSrc={image}\n                x={focus.x}\n                y={focus.y}\n              />\n            </div>\n            <div className=\"center-right\">\n              <FocusedImage\n                imageSrc={image}\n                x={focus.x}\n                y={focus.y}\n              />\n            </div>\n          </div>\n        </div>\n      </div>}\n    </div>}\n    </>\n  );\n};\n\nconst rootElement = document.getElementById(\"root\");\nReactDOM.render(<App />, rootElement);\n"],"sourceRoot":""}